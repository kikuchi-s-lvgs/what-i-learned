# インプットメモ

## ビジネス関連

- 

## 開発関連

- gulp→CSSコンパイルや圧縮
- babel→ES6からES5へのトランスパイル
- Webpack→モジュールのバンドル
- GulpやBabelでやっていることはすべてWebpackでできる。しかし、JSファイルとして吐いてしまうので、CSSコンパイルのまま残したいとかなら、Gulp＋Webpackはありうる選択肢。
- **今のチームとしては、基本的にはWPのみで開発する方針になっている。しかし、DFが一部Gulpを使用しているらしいので残っている。6月中にはWPに移行する予定とのこと。**
- PHPでビルドされたモジュールはPublic配下に置かれる。それをNginxで指定して配信する。
- nginxの設定ファイルは、共通部分は共通部分に書いてあるし、個別の違いとしても
  - サーバー名
  - ディレクトリ名
  - fastcgi用のunixに使用されるディレクトリ名
  - くらいしか変わらない。基本的な設定はすべて同じになっている。
  - nginx.confのL30にある`include /etc/nginx/sites-enabled/*;`にある通り、ここでサービス別のコンフィグを読み込んでいる。
  - nginxとしてはすべてのサービスのPHPがあるという前提で設定されていて、起動時に切り分けているわけではない。あくまで呼び出し先（サーバーネーム）、に対してルーティングされているだけ。
  - 同時に複数のサービスを立ち上げるときは、LocalhostでかぶるのでPortを散らしてあげる必要あり。
- githubにアクセスできるように、SSHキーを発行して~/.sshに配置。その後は基本的にこの情報を持ってgitを使う。基本的にはプライベートリポジトリはこのやり方。

### ハマりポイント

- not implement エラーが出たらnodemodulesを削除してからyarn cache cleanしてもう一度yarnを実行。

- PHPのルーティングエラーが出たらbootstrap/cache/router.phpを削除してphp artisan route:clearを実行。それからyarn devで立ち上がるはず。
- localhostにアクセスできないときはESETのワークのルールに内向きのトラフィクをネットワーク全体で許可してあげればOK。今後もネットワーク関係で詰まったらESETを先に疑ってみると良いかも…



## 気になったこと

- composeもyarnもPHPのイメージに入れちゃえばよいのでは…？Localだし、性能に問題がなければそのほうがかんたんな気もするけど…
  - 開発環境に関しては自分の使いやすいように改善していってOKとのこと。あとからいい感じに出来上がったらPR出してみるとかしてみる。
- STGに持っていくときやSTGのビルドはどうやっているのか。
  - STGへのリリースは、masterへのマージのあと、stgリリース用のブランチに対してマージをかけるとそれをトリガーにしてリリースされる。つまりPRを承認したらリリースされる。
  - PRDへのリリースは、タグを打ったらリリースされる。
  - どちらにせよ、機能別にマージされてリリースされるようになっているぽい。
    - この辺は実際にPR出すときに流れを見てみると良さそう。

- ESとKibanaは使っているのか。Line環境を動かすことはあるのか。（DFのみ？）
  - 基本的にはLocalでは使っていない。AWS環境にESがなかった名残。一応開発の都合で使いたいときに使用することはありうる。基本は使わないはず。

- ComposeファイルにはKO・KC・DF以外にHNくらいしかないけどほかは触らないの？CMS使用はHNだけ？
  CMSDBだけAWSじゃないのはなぜか。どうせならAWSに載せちゃえばエンドポイントだけで済みそうだけど…
  というか全員開発環境のDBを共有していて不備は起きないのか。データをいじることってそもそもない？？？
  - 頻繁に触ることはないのでCMSDBに関してはAWS環境に乗っていない。
  - HNが最近切り出されたが、今後CMS系のナス女とかも切り出されていく方針なので今後は増えていくはず。だが、現状としては上記のサービスに集中していればOK
  - 厳密なテストの場合はSTGでやるからそこまで問題ない。大きな変更をする際やテストをしたい場合はスラックで声をかけると良い。

