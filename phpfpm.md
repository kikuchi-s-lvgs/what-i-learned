# phpの環境について

## php-fmpとは

- php-fpm→php-fastrcgi process managerのこと。WebserverとPHPプログラムを繋ぐためのプロセス。
- cgi→fast common gateway interfaceのこと。ウェブサーバー上でユーザーのプログラムを動作させるための仕組み。クライアントからのリクエストをもとに情報を動的に生成するためのIF。ウェブサーバーだけではそれは出来ないので、CGI経由で別のプログラムを呼び出し、情報を動的に生成してもらって、クライアントに返している。つまり、Webサーバーとは別のプロセスとして実行される。
- fastcgi→CGIの改良版。一度来たリクエストのプロセスをメモリに保存する。今後はそのメモリに保存したプロセスを動かすので効率的。以前はリクエストが来るたびに毎回プロセスを生成して破棄していた。

## モジュール版とCGI版

- PHPを動かすにはCGIの他にもモジュールとして起動することもできる。Webサーバーの処理（プロセス）の中に組み込まれて実行される。モジュール版は実行が早い。
- Appacheはモジュールとして起動できるのでphp-fpmは不要。インストールするだけで実行できる。
- nginxはCGIとして実行しないといけない。ちなみに、appacheでもCGIを使用することはできる。

## nginxとphp-fpm間の通信

- tcp or unixドメインソケットのどちらか
- tcpの場合はlocalhost:portの形で指定。
- Unixドメインソケットの場合はファイルパスで指定。**Unixドメインソケット**
- ソケット→セッション層。TCP/UDPのひとつ上の層。
- UNIXドメインソケット→同じマシンで動いているプロセス間で通信を行うためのソケット。ファイルシステムを使用して相手を特定している。ファイル名で指定する。TCP通信よりも圧倒的に早い。なので同じマシンで通信するときで、Unixドメインソケットに対応しているサーバーの場合は使用したほうがスピードUPする。対応している主なサーバーは、nginx/mysql/redis/memcachedなど。